CREATE DATABASE IF NOT EXISTS DBUOC;

CREATE TABLE IF NOT EXISTS DBUOC.CLIENTS 
  (cod_cli TINYINT PRIMARY KEY, 
   name_cli VARCHAR(30) NOT NULL,
   nif CHAR(9) NOT NULL UNIQUE,
   address VARCHAR(50),
   city VARCHAR(30),
   phone CHAR(9)
) ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS DBUOC.DEPARTMENTS 
  (name_dpt VARCHAR(30),
   city_dpt VARCHAR(30),
   phone CHAR(9),
   PRIMARY KEY(name_dpt,city_dpt)
) ENGINE=InnoDB;
 
CREATE TABLE IF NOT EXISTS DBUOC.PROJECTS
  (cod_proj TINYINT PRIMARY KEY,
   name_proj VARCHAR(30) NOT NULL UNIQUE,
   price DECIMAL(9,2),
   iniDate DATE,
   prevFiDate DATE,
   fiDate DATE, 
   cod_client TINYINT,
   FOREIGN KEY (cod_client) REFERENCES DBUOC.CLIENTS (cod_cli) ON DELETE SET NULL ON UPDATE CASCADE,
   CHECK (iniDate < prevFiDate AND iniDate < fiDate)
) ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS DBUOC.EMPLOYEES 
  (cod_empl TINYINT PRIMARY KEY,
   name_empl VARCHAR(30) NOT NULL,
   surname_empl VARCHAR(30) NOT NULL,
   salary DECIMAL(9,2) CHECK (salary > 12500.00),
   name_dpt VARCHAR(30),
   city_dpt VARCHAR(30), 
   num_proj TINYINT,
   FOREIGN KEY (name_dpt,city_dpt) REFERENCES DBUOC.DEPARTMENTS(name_dpt,city_dpt) ON DELETE SET NULL ON UPDATE CASCADE,
   FOREIGN KEY (num_proj) REFERENCES DBUOC.PROJECTS(cod_proj) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB;


INSERT INTO DBUOC.CLIENTS
VALUES (10, 'ECIGSA', '38567893C', 'Aragó 242 4t 1ª', 'Barcelona', '932301520');

INSERT INTO DBUOC.CLIENTS
VALUES (20, 'CME', '38123898E', 'València 22', 'Girona', '972235721');

INSERT INTO DBUOC.CLIENTS
VALUES (30, 'ACME', '36432127A', 'Mallorca 33', 'LLeida', '973234567');

INSERT INTO DBUOC.CLIENTS
VALUES (40, 'JGM', '38782345B', 'Rosselló 44', 'Tarragona', '977337143');

INSERT INTO DBUOC.DEPARTMENTS
VALUES ('DIR', 'Barcelona', '934226070');

INSERT INTO DBUOC.DEPARTMENTS
VALUES ('DIR', 'Girona', '972238970');

INSERT INTO DBUOC.DEPARTMENTS
VALUES ('DISS', 'Lleida', '973235040');

INSERT INTO DBUOC.DEPARTMENTS
VALUES ('DISS', 'Barcelona', '932248523');

INSERT INTO DBUOC.DEPARTMENTS
VALUES ('PROG', 'Tarragona', '977333852');

INSERT INTO DBUOC.DEPARTMENTS
VALUES ('PROG', 'Girona', '972235091');

INSERT INTO DBUOC.PROJECTS
VALUES (1,'GESCOM',600000.00, '2004-1-1', '2005-1-1', NULL, 10);

INSERT INTO DBUOC.PROJECTS
VALUES (2,'PESCI',1200000.00, '2002-1-1', '2004-5-31', '2004-5-1', 10);

INSERT INTO DBUOC.PROJECTS
VALUES (3,'SALSA',600000.00, '2004-2-10', '2005-1-2', NULL, 20);

INSERT INTO DBUOC.PROJECTS
VALUES (4,'TINELL',2400000.00, '2003-1-1', '2005-1-12', NULL, 20);

INSERT INTO DBUOC.EMPLOYEES
VALUES (1, 'Maria', 'Puig', 60000.00, 'DIR', 'Girona', 1);

INSERT INTO DBUOC.EMPLOYEES
VALUES (2, 'Pere', 'Mas', 54000.00, 'DIR', 'Barcelona', 4);

INSERT INTO DBUOC.EMPLOYEES
VALUES (3, 'Anna', 'Ros', 42000.00, 'DISS', 'Lleida', 3);

INSERT INTO DBUOC.EMPLOYEES
VALUES (4, 'Jordi', 'Roca', 42000.00, 'DISS', 'Barcelona', 4);

INSERT INTO DBUOC.EMPLOYEES
VALUES (5, 'Clara', 'Blanc', 24000.00, 'PROG', 'Tarragona', 1);

INSERT INTO DBUOC.EMPLOYEES
VALUES (6, 'Laura', 'Tort', 18000.00, 'PROG', 'Tarragona', 3);

INSERT INTO DBUOC.EMPLOYEES
VALUES (7, 'Roger', 'Salt', 24000.00, NULL, NULL, 4);

INSERT INTO DBUOC.EMPLOYEES
VALUES (8, 'Sergi', 'Grau', 18000.00, 'PROG', 'Tarragona', NULL);

